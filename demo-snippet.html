<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-styles/color.html">
<link rel="import" href="bower_components/paper-styles/shadow.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/prism-highlighter/prism-highlighter.html">
<link rel="import" href="bower_components/marked-element/marked-element.html">

<!--
For example:

    <demo-snippet title="paper-checkbox demo">
      <paper-checkbox>Checkbox</paper-checkbox>
      <paper-checkbox checked>Checkbox</paper-checkbox>
    </demo-snippet>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`demo-snippet-header-background-color` | Background color of the header| `--paper-teal-500`
`demo-snippet-header-color` | Header text color| `white`
`--demo-snippet` | Mixin applied to the entire element | `{}`
`--demo-snippet-header` | Mixin applied to the title header | `{}`
`--demo-snippet-demo` | Mixin applied to the demo section | `{}`
`--demo-snippet-code` | Mixin applied to the code section | `{}`
-->
<dom-module id="demo-snippet">
  <style>
    :host {
      @apply(--layout-vertical);
      @apply(--center-justified);
      @apply(--shadow-elevation-2dp);
      @apply(--demo-snippet-header);
    }

    .header {
      background-color: var(--demo-snippet-header-background-color, --paper-teal-500);
      color: var(--demo-snippet-header-color, white);
      padding: 14px;
      margin: 0;
      font-weight: 300;
      font-size: 18px;
      @apply(--demo-snippet-header);
    }

    .demo {
      @apply(--layout-horizontal);
      padding: 24px;
      margin-left: auto;
      margin-right: auto;
      @apply(--demo-snippet-demo);
    }

    .code {
      position: relative;
      background-color: var(--paper-grey-50);
      border-top: 1px solid #e5e5e5;
      font-size: 13px;
      word-wrap: break-word;
      padding: 12px 24px;
      @apply(--demo-snippet-code);
    }

    paper-icon-button {
      position: absolute;
      top: 0;
      right: 0px;
    }
  </style>
  <template>
      <div class="header">[[title]]</div>

      <div id="demo" class="demo">
        <content id="content"></content>
      </div>

      <prism-highlighter></prism-highlighter>
      <div class="code">
        <marked-element id="codeSnippet" markdown="[[_getMarkdown(title)]]"></marked-element>
        <paper-icon-button icon="content-paste" title="copy to clipboard" on-click="copyToClipboard">
        </paper-icon-button>
      </div>
  </template>

  <script>
    Polymer({
      is: 'demo-snippet',

      properties: {
        title: {
          type: String,
          value: ''
        }
      },

      // Lol this needs to be a mutation observer.
      _getMarkdown: function(title) {
        var nodes = Polymer.dom(this).queryDistributedElements('*');

        var snippet = '';
        for (var i = 0; i < nodes.length; i++) {
          // Boolean properties, sigh. This is probably wrong.
          snippet += nodes[i].outerHTML.replace(/=""/g, '') + '\n';
        }

        return '```\n' + snippet + '```';
      },

      copyToClipboard: function() {
        // from https://github.com/google/material-design-lite/blob/master/docs/_assets/snippets.js
        'use strict';

        if (window.getSelection().toString().length > 0) {
          // user has selected some text manually
          // don't do anything
          return;
        }

        var snipRange = document.createRange();
        snipRange.selectNodeContents(this.$.codeSnippet);

        var sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(snipRange);

        var res = false;
        try {
          res = document.execCommand('copy');
        } catch (err) {
          // copy command is not available
          console.error(err);
        }
        sel.removeAllRanges();
        return res;
      }
    });
  </script>

</dom-module>
